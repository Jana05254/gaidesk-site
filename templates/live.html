<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø¢Ù† | GAIDESK</title>

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ù‡ÙˆÙŠØ© -->
  <style>
    :root {
      --bg-main: #f5faf4;        /* Ø£Ø®Ø¶Ø± Ø´ÙØ§Ù ÙØ§ØªØ­ Ø¬Ø¯Ø§ */
      --panel:   #eef5ee;        /* Ø¨Ø§Ù†ÙŠÙ„ Ø®ÙÙŠÙ */
      --text-main:#1f2922;       /* Ù†Øµ ØºØ§Ù…Ù‚ Ù…Ø§Ø¦Ù„ Ø£Ø®Ø¶Ø± */
      --accent:  #8f6a3b;        /* Ø§Ù„Ø°Ù‡Ø¨ÙŠ Ø§Ù„Ø¨Ù†ÙŠ Ø­Ù‚ Ø§Ù„Ø´Ø¹Ø§Ø± */
      --danger:  #b94a4a;
      --ok:      #1f7a4a;
    }
    body {
      background-color: var(--bg-main);
      color: var(--text-main);
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Inter", "Noto Sans Arabic", sans-serif;
    }
    .glass-card {
      background-color: var(--panel);
      backdrop-filter: blur(8px);
      box-shadow:
        0 20px 40px rgba(0,0,0,.07),
        0 1px 1px rgba(0,0,0,.04);
      border-radius: 1rem;
      border: 1px solid rgba(0,0,0,.04);
    }
    .section-title {
      font-size: .8rem;
      color: rgba(31,41,34,.55);
      font-weight: 500;
      letter-spacing: -.02em;
      display: flex;
      align-items: center;
      gap: .5rem;
    }
    .badge-soft {
      background-color: rgba(31,122,74,.08);
      color: var(--ok);
      font-size: .7rem;
      padding: .25rem .5rem;
      border-radius: .4rem;
      line-height: 1rem;
      font-weight: 500;
    }
    .badge-warn {
      background-color: rgba(185,74,74,.08);
      color: var(--danger);
      font-size: .7rem;
      padding: .25rem .5rem;
      border-radius: .4rem;
      line-height: 1rem;
      font-weight: 500;
    }
  </style>

  <!-- Ø®Ø·ÙˆØ· Ø£Ø±Ù‚Ø§Ù… Ù…ØªØ³Ø§ÙˆÙŠØ© Ø§Ù„Ø¹Ø±Ø¶ Ù„Ù„Ù‚Ø±Ø§Ø¡Ø§Øª -->
  <style>
    .mono {
      font-feature-settings: "tnum";
      font-variant-numeric: tabular-nums;
    }
  </style>
</head>

<body class="min-h-screen flex flex-col">

  <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± / Ø§Ù„Ù†Ø§Ù -->
  <header class="w-full border-b border-black/5 bg-[var(--panel)]/70 backdrop-blur sticky top-0 z-40">
    <div class="max-w-6xl mx-auto flex flex-wrap items-center justify-between gap-4 px-4 py-3">

      <!-- Ù„ÙˆØ¬Ùˆ Ø¨Ø³ÙŠØ· -->
      <a href="/" class="flex items-center gap-2">
        <div class="h-8 w-8 rounded-full bg-[var(--accent)]/90 text-white flex items-center justify-center font-semibold text-xs tracking-tight shadow-sm">
          G
        </div>
        <div class="flex flex-col leading-tight">
          <span class="text-sm font-semibold text-[var(--text-main)] -mb-0.5">GAIDESK</span>
          <span class="text-[10px] text-[var(--text-main)]/60">Smart Desk Coach</span>
        </div>
      </a>

      <!-- Ø±ÙˆØ§Ø¨Ø· -->
      <nav class="flex flex-wrap gap-2 text-[13px] font-medium">
        <a class="px-3 py-1.5 rounded-lg hover:bg-white hover:text-[var(--text-main)]/90 transition"
           href="/">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>

        <a class="px-3 py-1.5 rounded-lg bg-white text-[var(--text-main)] shadow-sm"
           href="/dashboard">Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø¢Ù†</a>

        <a class="px-3 py-1.5 rounded-lg hover:bg-white hover:text-[var(--text-main)]/90 transition"
           href="/summary">Ù…Ù„Ø®Øµ Ø§Ù„Ø¬Ù„Ø³Ø©</a>

        <a class="px-3 py-1.5 rounded-lg hover:bg-white hover:text-[var(--text-main)]/90 transition"
           href="/about">Ø¹Ù† Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</a>
      </nav>

    </div>
  </header>

  <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ -->
  <main class="flex-1 w-full max-w-6xl mx-auto px-4 py-8 space-y-10">

    <!-- ===== ØµÙ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ===== -->
    <section class="grid grid-cols-1 lg:grid-cols-3 gap-6">

      <!-- Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© -->
      <div class="glass-card p-5 flex flex-col justify-between">
        <div class="flex items-start justify-between">
          <div class="section-title">
            <span class="inline-block h-2 w-2 rounded-full bg-[var(--ok)] shadow-[0_0_8px_rgba(31,122,74,.6)]"></span>
            <span>Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ø¢Ù†</span>
          </div>
          <div id="deviceName"
               class="text-[11px] text-[var(--text-main)]/60 font-medium bg-white/60 px-2 py-[2px] rounded-md border border-black/5">
            GAIDESK-01
          </div>
        </div>

        <div class="mt-4 grid grid-cols-2 gap-4 text-center">
          <!-- Ø­Ø±Ø§Ø±Ø© -->
          <div class="bg-white/70 rounded-lg border border-black/5 py-4">
            <div class="text-[11px] text-[var(--text-main)]/60 font-medium">Ø§Ù„Ø­Ø±Ø§Ø±Ø©</div>
            <div id="tempVal" class="text-xl font-semibold text-[var(--text-main)] mono mt-1">--.-Â°C</div>
            <div id="tempHint" class="text-[11px] text-[var(--text-main)]/50 mt-1">â€”</div>
          </div>

          <!-- COâ‚‚ -->
          <div class="bg-white/70 rounded-lg border border-black/5 py-4">
            <div class="text-[11px] text-[var(--text-main)]/60 font-medium">Ø¬ÙˆØ¯Ø© Ø§Ù„Ù‡ÙˆØ§Ø¡ (COâ‚‚)</div>
            <div class="flex flex-col items-center mt-1">
              <div id="co2Val" class="text-xl font-semibold text-[var(--text-main)] mono">---- ppm</div>
              <div id="co2Hint" class="text-[11px] text-[var(--text-main)]/50 mt-1">â€”</div>
            </div>
          </div>
        </div>

        <div class="mt-4 grid grid-cols-2 gap-4 text-center">
          <!-- Ø¥Ø¬Ù‡Ø§Ø¯ Ø§Ù„Ø¬Ù„Ø³Ø© -->
          <div class="bg-white/70 rounded-lg border border-black/5 py-4 col-span-2 sm:col-span-1">
            <div class="text-[11px] text-[var(--text-main)]/60 font-medium">Ø¥Ø¬Ù‡Ø§Ø¯ Ø§Ù„Ø¬Ù„Ø³Ø© (fatigue)</div>
            <div id="fatigueVal" class="text-xl font-semibold text-[var(--text-main)] mono mt-1">0%</div>
            <div class="flex justify-center">
              <div id="fatigueBadge" class="badge-soft mt-2">Ù…Ø±ÙŠØ­</div>
            </div>
          </div>

          <!-- ÙˆØ¬ÙˆØ¯Ùƒ -->
          <div class="bg-white/70 rounded-lg border border-black/5 py-4 col-span-2 sm:col-span-1">
            <div class="text-[11px] text-[var(--text-main)]/60 font-medium">ÙˆØ¬ÙˆØ¯Ùƒ</div>
            <div id="presenceVal" class="text-xl font-semibold text-[var(--text-main)] mono mt-1">â€”</div>
            <div class="text-[11px] text-[var(--text-main)]/50 mt-1">1 = Ù…ÙˆØ¬ÙˆØ¯ / 0 = Ù…Ùˆ Ù…ÙˆØ¬ÙˆØ¯</div>
          </div>
        </div>

        <div class="text-[11px] text-[var(--text-main)]/50 mt-4 border-t border-black/10 pt-3 leading-relaxed">
          ÙŠØ¹ØªÙ…Ø¯ GAIDESK Ø¹Ù„Ù‰ Ø¬Ø³Ù…Ùƒ Ù†ÙØ³Ù‡ Ù…Ùˆ Ø¹Ù„Ù‰ ØªØ§ÙŠÙ…Ø± Ø«Ø§Ø¨Øª. Ù„Ùˆ ØªØ¹Ø¨Ùƒ ÙŠÙˆØµÙ„ 100% Ù„Ø§Ø²Ù… ØªÙˆÙ‚Ù ÙˆØªØ£Ø®Ø° Ø¨Ø±ÙŠÙƒ.
        </div>
      </div>

      <!-- Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„Ù…Ø¨Ø§Ø´Ø± -->
      <div class="glass-card p-5 flex flex-col justify-between lg:col-span-2">
        <div class="flex items-start justify-between">
          <div class="section-title">
            <span class="inline-block h-2 w-2 rounded-full bg-[var(--danger)] shadow-[0_0_8px_rgba(185,74,74,.6)]"></span>
            <span>Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„Ø­ÙŠ</span>
          </div>

          <span id="lastUpdate"
            class="text-[11px] text-[var(--text-main)]/60 font-medium bg-white/60 px-2 py-[2px] rounded-md border border-black/5">
            Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: â€”
          </span>
        </div>

        <div class="mt-4 bg-white/70 rounded-xl border border-black/5 p-5 flex flex-col md:flex-row items-start md:items-center justify-between gap-4">
          <div class="flex-1">
            <div id="alertTitle" class="text-[var(--text-main)] font-semibold text-lg leading-snug">
              ÙƒÙ„ Ø´ÙŠØ¡ Ø·Ø¨ÙŠØ¹ÙŠ ğŸ‘Œ
            </div>
            <div id="alertDesc" class="text-[13px] text-[var(--text-main)]/70 mt-1 leading-relaxed">
              Ø§Ù„Ø¬Ù„Ø³Ø© Ø­Ø§Ù„ÙŠØ§Ù‹ Ø¯Ø§Ø®Ù„ Ø§Ù„Ø­Ø¯ÙˆØ¯ Ø§Ù„Ù…Ø±ÙŠØ­Ø©. ÙƒÙ…Ù„ Ø´ØºÙ„Ùƒ ğŸ‘‡
            </div>
          </div>

          <div class="flex flex-col items-stretch text-center min-w-[8rem]">
            <div id="alertBadge" class="badge-soft w-full text-center">
              Ø·Ø¨ÙŠØ¹ÙŠ
            </div>
            <button
              onclick="location.href='/summary'"
              class="mt-3 text-[13px] font-medium bg-[var(--accent)] text-white rounded-lg px-4 py-2 shadow-sm hover:shadow transition">
              Ø´ÙˆÙ Ù…Ù„Ø®Øµ Ø§Ù„Ø¬Ù„Ø³Ø©
            </button>
          </div>
        </div>

        <div class="text-[11px] text-[var(--text-main)]/50 mt-4 leading-relaxed">
          ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§ Ù„Ùˆ ÙÙŠ Ø´ÙŠ Ø®Ø·Ø± ÙØ¹Ù„ÙŠ (ÙˆØ¶Ø¹ÙŠØ© Ø¬Ù„ÙˆØ³ Ø³ÙŠØ¦Ø© Ø¬Ø¯Ù‹Ø§ / Ù‚Ø±Ø¨Ùƒ Ù…Ù† Ø§Ù„Ø´Ø§Ø´Ø© / COâ‚‚ Ø¹Ø§Ù„ÙŠ / ØªØ¹Ø¨ 100%). Ø§Ù„ÙÙƒØ±Ø©: Ù…Ø§ Ù†Ù‚Ø§Ø·Ø¹Ùƒ Ø¥Ù„Ø§ Ù„Ùˆ Ø¬Ø³Ù…Ùƒ ÙØ¹Ù„Ø§Ù‹ Ø¨Ø¯Ø£ ÙŠÙ†Ù‡Ø§Ø± ğŸ”¥.
        </div>
      </div>

    </section>

    <!-- ===== Ø¬Ø¯ÙˆÙ„ Ø¢Ø®Ø± Ø§Ù„Ù‚Ø±Ø§Ø¡Ø§Øª ===== -->
    <section class="space-y-3">
      <div class="flex items-center justify-between">
        <div class="section-title text-[var(--text-main)]">
          <span class="inline-block h-2 w-2 rounded-full bg-[var(--text-main)]/50"></span>
          <span>Ø¢Ø®Ø± Ø§Ù„Ù‚Ø±Ø§Ø¡Ø§Øª</span>
        </div>
        <div
          id="tableDeviceName"
          class="text-[11px] text-[var(--text-main)]/60 font-medium bg-white/60 px-2 py-[2px] rounded-md border border-black/5">
          Ø§Ù„Ø¬Ù‡Ø§Ø²: GAIDESK-01
        </div>
      </div>

      <div class="glass-card overflow-hidden">
        <div class="overflow-x-auto">
          <table class="w-full text-[13px] text-[var(--text-main)]">
            <thead class="bg-white/60 border-b border-black/10 text-[11px] text-[var(--text-main)]/60 font-medium">
              <tr class="text-center">
                <th class="py-3 px-2 whitespace-nowrap font-medium">Ø§Ù„ÙˆÙ‚Øª</th>
                <th class="py-3 px-2 whitespace-nowrap font-medium">Ø§Ù„Ù€ % Ø¥Ø¬Ù‡Ø§Ø¯</th>
                <th class="py-3 px-2 whitespace-nowrap font-medium">COâ‚‚</th>
                <th class="py-3 px-2 whitespace-nowrap font-medium">Â°C</th>
                <th class="py-3 px-2 whitespace-nowrap font-medium">ÙˆØ¬ÙˆØ¯</th>
                <th class="py-3 px-2 whitespace-nowrap font-medium">Ø§Ù„Ù…Ø³Ø§ÙØ© (Ø³Ù…)</th>
              </tr>
            </thead>
            <tbody id="readingsBody" class="divide-y divide-black/5 text-center">
              <!-- Ø§Ù„Ø³Ø·ÙˆØ± ØªØªØ¹Ø¨Ù‰ Ø¨Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±Ø¨Øª -->
              <tr>
                <td colspan="6" class="py-8 text-[var(--text-main)]/40 text-[13px]">
                  Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <p class="text-[11px] text-[var(--text-main)]/50 leading-relaxed">
        Ù†Ø¹Ø±Ø¶ Ø¢Ø®Ø± Ø§Ù„Ù‚ÙŠØ§Ø³Ø§Øª Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ© Ø§Ù„Ù„ÙŠ Ø§Ù„Ø¬Ù‡Ø§Ø² Ø±Ø³Ù„Ù‡Ø§: Ø­Ø±Ø§Ø±Ø© / COâ‚‚ / Ù‚Ø±Ø¨Ùƒ Ù…Ù† Ø§Ù„Ø´Ø§Ø´Ø© / Ù‡Ù„ Ø£Ù†Øª Ù…ÙˆØ¬ÙˆØ¯ / ÙˆÙ†Ø³Ø¨Ø© Ø§Ù„Ø¥Ø¬Ù‡Ø§Ø¯ Ù„Ø­Ø¸ÙŠØ§Ù‹.
      </p>
    </section>

  </main>

  <!-- Ø§Ù„ÙÙˆØªØ± -->
  <footer class="w-full border-t border-black/10 bg-[var(--panel)]/70 mt-12">
    <div class="max-w-6xl mx-auto px-4 py-6 text-[11px] flex flex-col sm:flex-row items-center justify-between gap-3 text-[var(--text-main)]/60 leading-relaxed">
      <div class="text-center sm:text-right">
        Â© <span id="year"></span> GAIDESK. Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.
      </div>
      <a href="https://www.linkedin.com/in/USERNAME_HERE"
         class="underline hover:text-[var(--accent)] transition"
         target="_blank" rel="noopener noreferrer">
        LinkedIn
      </a>
    </div>
  </footer>

  <!-- Ø³ÙƒØ±Ø¨Øª Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø© -->
  <script>
    async function fetchData() {
      try {
        // Ù†Ø¬ÙŠØ¨ Ø§Ù„Ø¯Ø§ØªØ§ Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ± ØªØ¨Ø¹Ùƒ (Flask API)
        // NOTE: Ù„Ø§Ø²Ù… ÙÙŠ server.py ÙŠÙƒÙˆÙ† Ø¹Ù†Ø¯Ùƒ /api/data ÙŠØ±Ø¬Ø¹ Ø¢Ø®Ø± Ø§Ù„Ù‚Ø±Ø§Ø¡Ø§Øª
        const r = await fetch('/api/data?limit=20');
        const json = await r.json(); // Ø´ÙƒÙ„Ù‡Ø§ [{key, value:{...}}]

        if (!Array.isArray(json) || json.length === 0) {
          setStatusEmpty();
          return;
        }

        // Ø¢Ø®Ø± Ø¹Ù†ØµØ± (Ø£Ø¬Ø¯Ø¯ Ù‚ÙŠØ§Ø³)
        const latest = json[0].value || {};
        const latestKey = json[0].key || "";
        updateNowSection(latest, latestKey);

        // Ø§Ù„Ø¬Ø¯ÙˆÙ„
        renderTable(json);
      } catch (err) {
        console.error(err);
      }
    }

    function setStatusEmpty() {
        document.getElementById('tempVal').textContent = '--.-Â°C';
        document.getElementById('tempHint').textContent = 'â€”';

        document.getElementById('co2Val').textContent = '---- ppm';
        document.getElementById('co2Hint').textContent = 'â€”';

        document.getElementById('fatigueVal').textContent = '0%';
        document.getElementById('fatigueBadge').textContent = 'â€”';

        document.getElementById('presenceVal').textContent = 'â€”';

        document.getElementById('alertTitle').textContent = 'Ù…Ø§ÙÙŠ Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹';
        document.getElementById('alertDesc').textContent  = 'Ø§Ù„Ø¬Ù‡Ø§Ø² Ù…Ø§ Ø£Ø±Ø³Ù„ Ù‚Ø±Ø§Ø¡Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„Ø­ÙŠÙ†.';
        document.getElementById('alertBadge').textContent = 'Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§ØªØµØ§Ù„';
        document.getElementById('alertBadge').className   = 'badge-warn w-full text-center';

        document.getElementById('lastUpdate').textContent = 'Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: â€”';

        const tbody = document.getElementById('readingsBody');
        tbody.innerHTML = `
          <tr>
            <td colspan="6" class="py-8 text-[var(--text-main)]/40 text-[13px]">
              Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù‚Ø±Ø§Ø¡Ø§Øª Ù…Ø­ÙÙˆØ¸Ø© Ø¨Ø¹Ø¯.
            </td>
          </tr>`;
    }

    function qualityCO2(ppm) {
      if (ppm == null || isNaN(ppm)) return {txt:'â€”',hint:'â€”',bad:false};
      if (ppm > 2000) return {txt: ppm + ' ppm', hint:'Ù‡ÙˆØ§Ø¡ Ø³ÙŠØ¦ Ø¬Ø¯Ù‹Ø§', bad:true};
      if (ppm > 1500) return {txt: ppm + ' ppm', hint:'Ù‡ÙˆØ§Ø¡ Ù…ØªØ¹Ø¨', bad:true};
      return {txt: ppm + ' ppm', hint:'Ù‡ÙˆØ§Ø¡ Ù…Ù‚Ø¨ÙˆÙ„', bad:false};
    }

    function fatigueInfo(F) {
      if (F == null || isNaN(F)) return {pct:'0%', badge:'â€”', warn:false};
      const pct = Math.round(F) + '%';
      if (F >= 100) return {pct, badge:'Ù‚Ù ÙÙˆØ±Ø§Ù‹', warn:true};
      if (F >= 70)  return {pct, badge:'Ø¥Ø¬Ù‡Ø§Ø¯ Ø¹Ø§Ù„ÙŠ', warn:true};
      return {pct, badge:'Ù…Ø±ÙŠØ­', warn:false};
    }

    function updateNowSection(latest, keyStr) {
      const temp = latest.t;
      const co2  = latest.co2;
      const pres = latest.presence;
      const dist = latest.dist;
      const F    = latest.F;

      // Ø­Ø±Ø§Ø±Ø©
      document.getElementById('tempVal').textContent =
        (temp != null && !isNaN(temp)) ? temp.toFixed(1) + 'Â°C' : '--.-Â°C';

      document.getElementById('tempHint').textContent =
        (temp != null && !isNaN(temp))
          ? (temp > 30 ? 'Ø¬Ùˆ Ø­Ø§Ø±' : 'Ø¬Ùˆ Ø¹Ø§Ø¯ÙŠ')
          : 'â€”';

      // CO2
      const co2q = qualityCO2(co2);
      document.getElementById('co2Val').textContent = co2q.txt;
      document.getElementById('co2Hint').textContent = co2q.hint;

      // Ø¥Ø¬Ù‡Ø§Ø¯
      const finfo = fatigueInfo(F);
      document.getElementById('fatigueVal').textContent = finfo.pct;
      const badgeEl = document.getElementById('fatigueBadge');
      badgeEl.textContent = finfo.badge;
      badgeEl.className = (finfo.warn ? 'badge-warn' : 'badge-soft') + ' mt-2';

      // ÙˆØ¬ÙˆØ¯
      document.getElementById('presenceVal').textContent =
        (pres === 1) ? 'Ù…ÙˆØ¬ÙˆØ¯' : (pres === 0) ? 'Ù…Ùˆ Ù…ÙˆØ¬ÙˆØ¯' : 'â€”';

      // Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«
      const tsMs = latest.ts;
      let tsText = 'â€”';
      if (typeof tsMs === 'number') {
        const d = new Date(tsMs);
        tsText = d.toLocaleString('ar-SA', { hour12:true });
      }
      document.getElementById('lastUpdate').textContent =
        'Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: ' + tsText;

      // Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„Ø­ÙŠ
      const alertTitleEl = document.getElementById('alertTitle');
      const alertDescEl  = document.getElementById('alertDesc');
      const alertBadgeEl = document.getElementById('alertBadge');

      // Ù…Ù†Ø·Ù‚ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡
      if (finfo.warn) {
        alertTitleEl.textContent = 'Ø¥Ø¬Ù‡Ø§Ø¯ Ø¹Ø§Ù„ÙŠ! Ù„Ø§Ø²Ù… ØªÙˆÙ‚Ù Ø´ÙˆÙŠØ© ';
        alertDescEl.textContent  = 'Ø¬Ø³Ù…Ùƒ Ù‚Ø§Ø¹Ø¯ ÙŠØªØ¹Ø¨. Ø®Ø° Ø¨Ø±ÙŠÙƒ Ø§Ù„Ø¢Ù† Ù‚Ø¨Ù„ Ù…Ø§ ØªÙˆØµÙ„ Ø­Ø¯ Ø®Ø·ÙŠØ±.';
        alertBadgeEl.textContent = finfo.badge;
        alertBadgeEl.className   = 'badge-warn w-full text-center';
      } else if (co2q.bad) {
        alertTitleEl.textContent = 'Ø§Ù„Ù‡ÙˆØ§Ø¡ Ù…Ùˆ ÙƒÙˆÙŠØ³ ';
        alertDescEl.textContent  = 'Ø§ÙØªØ­ Ø§Ù„Ø´Ø¨Ø§Ùƒ / Ø¨Ø¯Ù‘Ù„ Ø§Ù„Ù…ÙƒØ§Ù† Ù„Ø­Ø¸ÙŠØ§Ù‹. Ù…Ø³ØªÙˆÙ‰ COâ‚‚ Ù…Ø±ØªÙØ¹ ÙˆÙ…Ù…ÙƒÙ† ÙŠØ³Ø¨Ø¨ ØµØ¯Ø§Ø¹ ÙˆØªØ¹Ø¨.';
        alertBadgeEl.textContent = 'ØªÙ‡ÙˆÙŠØ© Ø³ÙŠØ¦Ø©';
        alertBadgeEl.className   = 'badge-warn w-full text-center';
      } else if (dist != null && !isNaN(dist) && dist < 45) {
        alertTitleEl.textContent = 'Ù‚Ø±ÙŠØ¨ Ù…Ø±Ù‘Ù‡ Ù…Ù† Ø§Ù„Ø´Ø§Ø´Ø© ';
        alertDescEl.textContent  = 'Ø§Ø¨Ø¹ÙØ¯ Ø´ÙˆÙŠ Ø¹Ù† Ø§Ù„Ø´Ø§Ø´Ø© Ø¹Ø´Ø§Ù† Ø±Ù‚Ø¨ØªÙƒ ÙˆØ¹ÙŠÙˆÙ†Ùƒ.';
        alertBadgeEl.textContent = 'ÙˆØ¶Ø¹ÙŠØ© ØºÙŠØ± ØµØ­ÙŠØ©';
        alertBadgeEl.className   = 'badge-warn w-full text-center';
      } else {
        alertTitleEl.textContent = 'ÙƒÙ„ Ø´ÙŠØ¡ Ø·Ø¨ÙŠØ¹ÙŠ ';
        alertDescEl.textContent  = 'Ø§Ù„Ø¬Ù„Ø³Ø© Ø­Ø§Ù„ÙŠØ§Ù‹ Ø¯Ø§Ø®Ù„ Ø§Ù„Ø­Ø¯ÙˆØ¯ Ø§Ù„Ù…Ø±ÙŠØ­Ø©. ÙƒÙ…Ù„ Ø´ØºÙ„Ùƒ';
        alertBadgeEl.textContent = 'Ø·Ø¨ÙŠØ¹ÙŠ';
        alertBadgeEl.className   = 'badge-soft w-full text-center';
      }
    }

    function renderTable(list) {
      const tbody = document.getElementById('readingsBody');
      tbody.innerHTML = '';

      // list: [{key, value:{...}}, ...]  (Ø£Ø¬Ø¯Ø¯ Ø£ÙˆÙ„ Ø¹Ù†ØµØ±)
      list.forEach((row, idx) => {
        const val = row.value || {};
        const ts  = val.ts;
        const d   = (typeof ts === 'number') ? new Date(ts) : null;
        const timeTxt = d
          ? d.toLocaleString('ar-SA', {hour12:true})
          : 'â€”';

        const finfo = fatigueInfo(val.F);
        const co2v  = (val.co2 != null && !isNaN(val.co2)) ? val.co2 : 'â€”';
        const tempv = (val.t   != null && !isNaN(val.t))   ? val.t.toFixed(1) : 'â€”';
        const presv = (val.presence === 1) ? 'Ù…ÙˆØ¬ÙˆØ¯' :
                      (val.presence === 0) ? 'Ù…Ùˆ Ù…ÙˆØ¬ÙˆØ¯' : 'â€”';
        const distv = (val.dist != null && !isNaN(val.dist))
                      ? Math.round(val.dist) : 'â€”';

        const tr = document.createElement('tr');
        tr.className = "text-center text-[13px] text-[var(--text-main)]/90 hover:bg-white/50 transition";

        tr.innerHTML = `
          <td class="py-3 px-2 whitespace-nowrap mono text-[var(--text-main)]/70">${timeTxt}</td>
          <td class="py-3 px-2 whitespace-nowrap mono">
            ${finfo.pct}
          </td>
          <td class="py-3 px-2 whitespace-nowrap mono">${co2v}</td>
          <td class="py-3 px-2 whitespace-nowrap mono">${tempv}</td>
          <td class="py-3 px-2 whitespace-nowrap">${presv}</td>
          <td class="py-3 px-2 whitespace-nowrap mono">${distv}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    // Ø³Ù†Ø© ÙÙŠ Ø§Ù„ÙÙˆØªØ±
    document.getElementById('year').textContent = new Date().getFullYear();

    // ØªØ­Ø¯ÙŠØ« ÙƒÙ„ Ø´ÙˆÙŠØ© (5 Ø«ÙˆØ§Ù†ÙŠ)
    fetchData();
    setInterval(fetchData, 5000);
  </script>
</body>
</html>
